<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Tiết Sản Phẩm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#DC2626',
                        secondary: '#F3F4F6',
                    }
                }
            }
        }
    </script>
    <style>
        .product-card { transition: all 0.3s ease; }
        /* Hiệu ứng hover cho card: bay lên xíu + đổ bóng */
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.15); border-color: #DC2626; }
        
        /* Animation hiện comment */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        .comment-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    </style>
</head>
<body class="bg-secondary font-sans antialiased flex flex-col min-h-screen">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <a href="home.html" class="flex items-center gap-2 group">
                    <div class="w-10 h-10 bg-primary text-white rounded flex items-center justify-center text-xl font-bold">L</div>
                    <span class="text-2xl font-bold text-primary tracking-tight">LAPTOP STORE</span>
                </a>
                
                <nav class="hidden md:flex space-x-8">
                    <a href="home.html" class="text-gray-600 hover:text-primary font-medium transition">Trang Chủ</a>
                    <a href="product.html" class="text-primary font-bold border-b-2 border-primary">Sản Phẩm</a>
                </nav>
                
                <div class="flex items-center gap-4">
                    <form action="product.html" method="GET" class="hidden md:block relative">
                        <input type="text" name="search" placeholder="Tìm tên máy..." class="pl-4 pr-10 py-2 border border-gray-300 rounded-full focus:outline-none focus:border-primary w-64 text-sm">
                        <button class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary"><i class="fas fa-search"></i></button>
                    </form>

                    <a href="cart.html" class="relative text-gray-600 hover:text-primary transition">
                        <i class="fas fa-shopping-cart text-xl"></i>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-primary text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
                    </a>

                    <div id="auth-section" class="pl-2 border-l border-gray-300 ml-2">
                        <a href="login.html" class="flex items-center gap-2 text-sm font-medium text-gray-700 hover:text-primary bg-gray-100 hover:bg-gray-200 px-3 py-2 rounded-full transition">
                            <i class="fas fa-user-circle text-lg"></i> <span>Đăng nhập</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 flex-grow">
        <div class="text-sm text-gray-500 mb-6 flex items-center gap-2">
            <a href="home.html" class="hover:text-primary transition">Trang chủ</a> 
            <i class="fas fa-chevron-right text-xs"></i>
            <a href="product.html" class="hover:text-primary transition">Sản phẩm</a>
            <i class="fas fa-chevron-right text-xs"></i>
            <span class="text-gray-800 font-medium" id="bread-name">...</span>
        </div>

        <div id="product-detail" class="bg-white rounded-xl shadow-lg p-8 mb-8">
            <p class="text-center py-10">Đang tải thông tin...</p>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-8 mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-l-4 border-primary pl-3">Đánh giá & Hỏi đáp</h2>
            
            <div class="mb-8">
                <textarea id="comment-input" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:border-primary transition" rows="3" placeholder="Mời bạn để lại bình luận..."></textarea>
                <div class="flex justify-end mt-2">
                    <button onclick="postComment()" class="bg-primary text-white px-6 py-2 rounded-lg font-bold hover:bg-red-700 transition">Gửi Bình Luận</button>
                </div>
            </div>

            <div id="comment-list" class="space-y-6">
                <div class="flex gap-4 border-b pb-4">
                    <div class="comment-avatar bg-blue-100 text-blue-600">H</div>
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <span class="font-bold text-gray-800">Hoàng Nam</span>
                            <span class="text-xs text-gray-400">2 giờ trước</span>
                        </div>
                        <div class="text-yellow-400 text-sm mb-1"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                        <p class="text-gray-600">Máy đẹp, chạy mượt, giao hàng nhanh. Rất hài lòng!</p>
                    </div>
                </div>
                <div class="flex gap-4 border-b pb-4">
                    <div class="comment-avatar bg-green-100 text-green-600">T</div>
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <span class="font-bold text-gray-800">Trần Ly</span>
                            <span class="text-xs text-gray-400">1 ngày trước</span>
                        </div>
                        <div class="text-yellow-400 text-sm mb-1"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i></div>
                        <p class="text-gray-600">Sản phẩm tốt trong tầm giá, nhân viên tư vấn nhiệt tình.</p>
                    </div>
                </div>
            </div>
        </div>

        <section>
            <div class="flex items-center gap-3 mb-6">
                <i class="fas fa-heart text-primary text-xl"></i>
                <h2 class="text-2xl font-bold text-gray-800">Có thể bạn sẽ thích</h2>
            </div>
            
            <div id="similar-products" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
                </div>
        </section>
    </main>

    <footer class="bg-gray-900 text-white py-8 text-center mt-auto">&copy; 2025 Laptop Store. All rights reserved.</footer>

    <script>
        // 1. DATABASE GIẢ LẬP
        const products = [
            { id: 1, name: 'Dell XPS 13 Plus 9320', price: 35990000, oldPrice: 39990000, img: 'https://images.unsplash.com/photo-1593642632823-8f78536788c6?auto=format&fit=crop&w=400&q=80', tag: 'office', specs: {CPU:'i7-1360P', RAM:'16GB', SSD:'512GB', Screen:'13.4" OLED'} },
            { id: 2, name: 'MacBook Air M2 2023', price: 26990000, oldPrice: 28990000, img: 'https://images.unsplash.com/photo-1611186871348-640e087f15d0?auto=format&fit=crop&w=400&q=80', tag: 'macbook', specs: {CPU:'Apple M2', RAM:'8GB', SSD:'256GB', Screen:'13.6" Liquid Retina'} },
            { id: 3, name: 'Asus ROG Strix G15', price: 32490000, oldPrice: 35000000, img: 'https://images.unsplash.com/photo-1603302576837-37561b2e2302?auto=format&fit=crop&w=400&q=80', tag: 'gaming', specs: {CPU:'Ryzen 7 6800H', RAM:'16GB', SSD:'512GB', GPU:'RTX 3050'} },
            { id: 4, name: 'Lenovo Legion 5 Pro', price: 38990000, oldPrice: 42000000, img: 'https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?auto=format&fit=crop&w=400&q=80', tag: 'gaming', specs: {CPU:'i7-12700H', RAM:'16GB', SSD:'1TB', GPU:'RTX 3060'} },
            { id: 5, name: 'HP Envy 13', price: 19990000, oldPrice: 22000000, img: 'https://images.unsplash.com/photo-1544731612-de7f96afe55f?auto=format&fit=crop&w=400&q=80', tag: 'office', specs: {CPU:'i5-1135G7', RAM:'8GB', SSD:'512GB', Screen:'13.3" FHD'} },
            { id: 6, name: 'Acer Nitro 5 Tiger', price: 21490000, oldPrice: 24990000, img: 'https://images.unsplash.com/photo-1542393545-facac42e679e?auto=format&fit=crop&w=400&q=80', tag: 'gaming', specs: {CPU:'i5-11400H', RAM:'8GB', SSD:'512GB', GPU:'GTX 1650'} },
            { id: 7, name: 'MacBook Pro 14 M3', price: 45990000, oldPrice: 48990000, img: 'https://images.unsplash.com/photo-1517336714731-489689fd1ca4?auto=format&fit=crop&w=400&q=80', tag: 'macbook', specs: {CPU:'M3 Pro', RAM:'18GB', SSD:'512GB', Screen:'14.2" XDR'} },
            { id: 8, name: 'LG Gram 16 2024', price: 29990000, oldPrice: 33000000, img: 'https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?auto=format&fit=crop&w=400&q=80', tag: 'office', specs: {CPU:'i7-1260P', RAM:'16GB', SSD:'512GB', Weight:'1.19kg'} }
        ];

        // LOAD TRANG
        window.onload = () => {
            updateCartBadge();
            checkAuth();

            const params = new URLSearchParams(window.location.search);
            const id = parseInt(params.get('id'));
            const product = products.find(p => p.id === id);

            if (!product) {
                document.getElementById('product-detail').innerHTML = `<div class="text-center py-20 text-xl font-bold text-gray-500">Sản phẩm không tồn tại hoặc đã bị xóa.</div>`;
                return;
            }

            // Cập nhật Title và Breadcrumb
            document.title = product.name;
            document.getElementById('bread-name').innerText = product.name;

            // Render Specs Table (Cho phần chi tiết chính)
            let specsHTML = '';
            for (const [key, value] of Object.entries(product.specs)) {
                specsHTML += `
                    <tr class="even:bg-gray-50 border-b last:border-0 hover:bg-gray-100 transition">
                        <td class="py-3 px-4 font-semibold text-gray-600 w-1/3">${key}</td>
                        <td class="py-3 px-4 text-gray-800 font-medium">${value}</td>
                    </tr>`;
            }

            const discount = Math.round(((product.oldPrice - product.price) / product.oldPrice) * 100);

            // Render Detail HTML
            document.getElementById('product-detail').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <div class="bg-white rounded-xl p-6 flex items-center justify-center border border-gray-100 relative group shadow-sm">
                        <img src="${product.img}" class="w-full h-auto object-contain rounded-lg max-h-[400px] transform group-hover:scale-105 transition duration-500">
                        ${discount > 0 ? `<span class="absolute top-4 left-4 bg-red-600 text-white font-bold px-3 py-1 rounded shadow-md z-10 animate-pulse">- ${discount}%</span>` : ''}
                    </div>
                    
                    <div>
                        <div class="mb-4">
                            <span class="text-xs font-bold uppercase bg-blue-100 text-blue-600 px-3 py-1 rounded-full tracking-wide">${product.tag}</span>
                            <span class="text-xs font-bold uppercase bg-green-100 text-green-600 px-3 py-1 rounded-full ml-2 tracking-wide"><i class="fas fa-check-circle"></i> Còn hàng</span>
                        </div>
                        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4 leading-tight">${product.name}</h1>
                        
                        <div class="flex items-end gap-3 mb-6 bg-gray-50 p-5 rounded-xl border border-gray-100">
                            <p class="text-primary font-bold text-3xl md:text-4xl">${product.price.toLocaleString('vi-VN')}đ</p>
                            <p class="text-gray-400 text-lg line-through mb-1">${product.oldPrice.toLocaleString('vi-VN')}đ</p>
                        </div>

                        <div class="mb-8">
                            <h3 class="font-bold text-gray-800 mb-3 text-lg"><i class="fas fa-cogs text-gray-400"></i> Cấu hình chi tiết:</h3>
                            <div class="border rounded-xl overflow-hidden shadow-sm">
                                <table class="w-full text-sm"><tbody>${specsHTML}</tbody></table>
                            </div>
                        </div>

                        <div class="flex gap-4">
                            <button onclick="addToCart('${product.id}')" class="flex-1 px-6 py-4 bg-blue-50 text-blue-600 font-bold rounded-xl hover:bg-blue-100 transition border border-blue-200 flex justify-center items-center gap-2 text-lg">
                                <i class="fas fa-cart-plus"></i> Thêm Giỏ
                            </button>
                            <button onclick="buyNow('${product.id}')" class="flex-1 px-6 py-4 bg-primary text-white font-bold rounded-xl hover:bg-red-700 transition shadow-lg shadow-red-200 flex justify-center items-center gap-2 text-lg">
                                <i class="fas fa-bolt"></i> Mua Ngay
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Gọi hàm render Similar với chế độ "Cao 400px"
            renderSimilar(product.tag, product.id);
        };

        // 2. RENDER SIMILAR PRODUCTS (ĐÃ SỬA: CAO 400PX + HIỆN HẾT THÔNG SỐ)
        function renderSimilar(tag, currentId) {
            const grid = document.getElementById('similar-products');
            
            // Logic lọc sản phẩm (giữ nguyên)
            let similar = products.filter(p => p.tag === tag && p.id !== currentId);
            if (similar.length < 4) {
                const others = products.filter(p => p.tag !== tag && p.id !== currentId);
                similar = similar.concat(others);
            }
            similar = similar.slice(0, 4);

            similar.forEach(p => {
                const discountSim = Math.round(((p.oldPrice - p.price) / p.oldPrice) * 100);

                // TẠO HTML CHO CÁC DÒNG THÔNG SỐ
                // Loop qua object specs để lấy key (CPU) và value (i7...)
                let specsRendered = '';
                for (const [key, value] of Object.entries(p.specs)) {
                    specsRendered += `
                        <div class="flex justify-between border-b border-dashed border-gray-200 last:border-0 py-1">
                            <span class="text-gray-500 font-semibold w-1/3">${key}</span>
                            <span class="text-gray-800 font-bold truncate text-right w-2/3" title="${value}">${value}</span>
                        </div>
                    `;
                }

                // RENDER CARD
                // Lưu ý class: min-h-[420px] để đảm bảo chiều cao cố định tối thiểu
                grid.insertAdjacentHTML('beforeend', `
                    <div class="product-card bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden relative group cursor-pointer flex flex-col min-h-[420px]" onclick="window.location.href='detail.html?id=${p.id}'">
                        ${discountSim > 0 ? `<span class="absolute top-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded shadow z-10">-${discountSim}%</span>` : ''}
                        
                        <div class="relative h-44 overflow-hidden bg-gray-50 flex items-center justify-center p-4">
                            <img src="${p.img}" alt="${p.name}" class="max-h-full max-w-full object-contain transform group-hover:scale-110 transition duration-500">
                        </div>

                        <div class="p-4 flex-grow flex flex-col">
                            <h3 class="font-bold text-gray-800 text-sm mb-2 h-10 line-clamp-2 leading-tight hover:text-primary transition">${p.name}</h3>
                            
                            <div class="bg-gray-50 rounded-lg p-2 text-[11px] mb-3 flex-grow border border-gray-100">
                                ${specsRendered}
                            </div>

                            <div class="mt-auto">
                                <div class="flex items-end gap-2 mb-3">
                                    <p class="text-primary font-bold text-base">${p.price.toLocaleString('vi-VN')}đ</p>
                                    <p class="text-gray-400 text-xs line-through pb-0.5">${p.oldPrice.toLocaleString('vi-VN')}đ</p>
                                </div>
                                <button class="w-full py-2 text-xs font-bold text-primary border border-primary rounded hover:bg-primary hover:text-white transition uppercase tracking-wide">Xem Chi Tiết</button>
                            </div>
                        </div>
                    </div>
                `);
            });
        }

        // 3. CÁC HÀM HỖ TRỢ (GIỮ NGUYÊN)
        function postComment() {
            const content = document.getElementById('comment-input').value.trim();
            const user = JSON.parse(localStorage.getItem('currentUser'));

            if (!user) {
                Swal.fire('Vui lòng đăng nhập', 'Bạn cần đăng nhập để bình luận.', 'warning');
                return;
            }
            if (!content) {
                Swal.fire('Lỗi', 'Nội dung bình luận không được để trống.', 'info');
                return;
            }

            const list = document.getElementById('comment-list');
            const colorClass = ['bg-blue-100 text-blue-600', 'bg-red-100 text-red-600', 'bg-purple-100 text-purple-600'][Math.floor(Math.random()*3)];
            
            const html = `
                <div class="flex gap-4 border-b pb-4 animate-fade-in">
                    <div class="comment-avatar ${colorClass}">${user.name.charAt(0).toUpperCase()}</div>
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <span class="font-bold text-gray-800">${user.name}</span>
                            <span class="text-xs text-gray-400">Vừa xong</span>
                        </div>
                        <p class="text-gray-600">${content}</p>
                    </div>
                </div>
            `;
            
            list.insertAdjacentHTML('afterbegin', html);
            document.getElementById('comment-input').value = '';
            const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 2000 });
            Toast.fire({ icon: 'success', title: 'Đã gửi bình luận' });
        }

        function checkAuth() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (user) {
                const link = user.role === 'admin' ? '../Admin/admin.html' : 'user.html';
                const label = user.role === 'admin' ? 'Admin' : user.name.split(' ').pop();
                document.getElementById('auth-section').innerHTML = `
                    <div class="flex items-center gap-3">
                        <a href="${link}" class="flex items-center gap-2 group">
                            <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center text-primary font-bold border border-red-200">${user.name.charAt(0)}</div>
                            <span class="hidden md:inline text-sm font-bold text-gray-700 group-hover:text-primary">Chào, ${label}</span>
                        </a>
                        <button onclick="logout()" class="text-gray-400 hover:text-red-600" title="Đăng xuất"><i class="fas fa-sign-out-alt"></i></button>
                    </div>
                `;
            }
        }

        function logout() {
            Swal.fire({ title: 'Đăng xuất?', text: "Bạn có chắc chắn muốn thoát?", icon: 'question', showCancelButton: true, confirmButtonText: 'Đồng ý', cancelButtonText: 'Hủy', confirmButtonColor: '#DC2626' }).then((r) => {
                if (r.isConfirmed) { localStorage.removeItem('currentUser'); window.location.reload(); }
            });
        }

        function addToCart(id) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let item = cart.find(i => i.id == id);
            item ? item.qty++ : cart.push({id: id, qty: 1});
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
            const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 1500 });
            Toast.fire({ icon: 'success', title: 'Đã thêm vào giỏ' });
        }

        function buyNow(id) {
            addToCart(id);
            window.location.href = 'cart.html';
        }

        function updateCartBadge() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const count = cart.reduce((sum, i) => sum + i.qty, 0);
            const badge = document.getElementById('cart-count');
            badge.innerText = count;
            count > 0 ? badge.classList.remove('hidden') : badge.classList.add('hidden');
        }
    </script>
</body>
</html>